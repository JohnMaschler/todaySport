<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

<style>
	.swiper-container {
		width: 80%;
		height: 100px;
		margin: 20px auto;
		position: relative;
		overflow: hidden;
	}
	.swiper-slide {
		background: #1e1e1e;
		display: flex;
		justify-content: center;
		align-items: center;
		padding-left: 10px;
		padding-right: 10px;
		padding-bottom: 20px;
		color: #fff;
		border: none;
	}
	.matchup-card {
		display: grid;
		grid-template-columns: 1fr 1fr;
		grid-template-rows: auto 1fr 1px solid #444 1fr;
		width: 100%;
		height: 80%;
		font-size: 16px;
		font-family: Arial, sans-serif;
		align-items: center;
	}

	.team-name {
		display: flex;
		justify-content: center;
		margin-bottom: 5px;
		padding-bottom: 5px;
		border-bottom: 2px solid #444;
	}

	.matchup-value {
		display: flex;
		align-items: center;
		justify-content: center;
	}
	.game-time {
		display: flex;
		justify-content: center;
		grid-column: span 2;
		font-size: 14px;
		color: #888;
	}
	.swiper-button-prev,
	.swiper-button-next {
		color: #fff;
		position: absolute;
		top: 72%;
		transform: translateY(-50%);
		z-index: 10;
		height: 100px;
		width: 30px;
		background: linear-gradient(to right, rgba(0, 0, 0, 0.6), transparent);
		border: none;
		outline: none;
	}
	.swiper-button-prev {
		left: 0px;
		background: linear-gradient(
			to right,
			rgba(51, 51, 51, 1),
			rgba(51, 51, 51, 0)
		);
	}
	.swiper-button-next {
		right: 0px;
		background: linear-gradient(
			to left,
			rgba(51, 51, 51, 1),
			rgba(51, 51, 51, 0)
		);
	}
	.matchup-value {
		color: #4caf50;
	}
	#oddsType {
		position: relative;
		top: 70px;
		left: 50px;
		transform: translateY(-50%);
		z-index: 100;
		background: #1e1e1e;
		color: #fff;
		border: 1px solid #555;
		padding: 10;
	}

	.game-date {
		display: flex;
		justify-content: center;
		grid-column: span 2;
		font-size: 14px;
		color: #888;
		margin-bottom: 5px;
	}
	.venue {
		display: flex;
		justify-content: center;
		grid-column: span 2;
		font-size: 14px;
		color: #ccc;
		margin-top: 2px;
	}
</style>

<div class="swiper-container">
	<div class="swiper-wrapper">
		<!-- slides will populate here -->
	</div>
	<!-- <div class="swiper-pagination"></div> -->
	<!-- If you want pagination then uncomment this line -->
	<div class="swiper-button-prev"></div>
	<div class="swiper-button-next"></div>
</div>

<select id="oddsType" onchange="updateDisplay()">
	<option value="ml">ML</option>
	<option value="spread">Spread</option>
	<option value="total">Total Money</option>
</select>

<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

<script>
	// const matchups = JSON.parse(
	// 	'[{"Visitor": "TOR", "Home": "BAL", "VisitorSpread": "+1.5", "HomeSpread": "+1.5", "VisitorSpreadPercent": "10%", "HomeSpreadPercent": "90%", "VisitorMoneyLine": "+145", "HomeMoneyLine": "-164", "HomeMoneyLinePercent": "16%", "VisitorMoneyLinePercent": "84%", "TotalRuns": "o6", "TotalMoneyPercentVisitor": "15%", "TotalMoneyPercentHome": "85%", "GameTime": "Today"}]'
	// );

	let swiper;

	document.addEventListener('DOMContentLoaded', function () {
		swiper = new Swiper('.swiper-container', {
			// Default number of slides for smaller screens
			slidesPerView: 3,
			spaceBetween: 2,
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			navigation: {
				nextEl: '.swiper-button-next',
				prevEl: '.swiper-button-prev',
			},
			observer: true,
			observeParents: true,
			observeSlideChildren: true,
			breakpoints: {
				320: {
					slidesPerView: 2,
					spaceBetween: 2,
				},
				480: {
					slidesPerView: 3,
					spaceBetween: 2,
				},
				640: {
					slidesPerView: 4,
					spaceBetween: 2,
				},
				768: {
					slidesPerView: 5,
					spaceBetween: 2,
				},
				920: {
					slidesPerView: 6,
					spaceBetween: 2,
				},
				1050: {
					slidesPerView: 7,
					spaceBetween: 2,
				},
				1280: {
					slidesPerView: 8,
					spaceBetween: 2,
				},
			},
		});

		// loadMatchups();
		fetchMatchups();
		updateDisplay();
	});

	function fetchMatchups() {
		fetch('https://todaysport-lerxv37nxa-uc.a.run.app/')
			.then((response) => {
				if (!response.ok) {
					console.log('did not work :(');
					throw new Error('Network response was not ok');
				}
				return response.json();
			})
			.then((data) => {
				loadMatchups(JSON.parse(data));
				fetchFutureGames();
			})
			.catch((error) => {
				console.error('Error fetching data:', error);
				alert('Failed to fetch data from the server');
			});
	}

	function fetchFutureGames() {
		fetch('http://localhost:5000/future')
			.then((response) => {
				if (!response.ok) {
					console.log('did not work :(');
					throw new Error('Network response was not ok');
				}
				return response.json();
			})
			.then((futureData) => {
				// console.log(futureData);
				loadFutureGames(JSON.parse(futureData));
			})
			.catch((error) => {
				console.error('Error fetching data:', error);
				alert('Failed to fetch data from the server');
			});
	}

	function loadMatchups(matchups) {
		matchups.forEach((matchup, index) => {
			const slideContent = `<div class="swiper-slide">
	        <div class="matchup-card">
	            <div class="game-time">${matchup.GameTime}</div>
	            <div class="team-name">${matchup.Home}</div>
	            <div class="team-name">${matchup.Visitor}</div>
	            <div class="matchup-value" id="ml-${index}" style="display: flex;">${matchup.HomeMoneyLine}</div>
	            <div class="matchup-value" id="ml-${index}" style="display: flex;">${matchup.VisitorMoneyLine}</div>
	            <div class="matchup-value" id="spread-${index}" style="display: none;">${matchup.HomeSpreadPercent}</div>
	            <div class="matchup-value" id="spread-${index}" style="display: none;">${matchup.VisitorSpreadPercent}</div>
	            <div class="matchup-value" id="total-${index}" style="display: none;">${matchup.TotalMoneyPercentHome}</div>
	            <div class="matchup-value" id="total-${index}" style="display: none;">${matchup.TotalMoneyPercentVisitor}</div>
	        </div>
	    </div>`;
			swiper.appendSlide(slideContent);
		});
	}

	function loadFutureGames(games) {
		swiper.appendSlide(
			`<div class="swiper-slide"><div class="matchup-card"><div class="game-time">Upcoming Games</div></div></div>`
		);

		games.forEach((game, index) => {
			const slideContent = `<div class="swiper-slide">
            <div class="matchup-card">
				<div class="game-date">${game.date} @ ${game.time}</div>
                <div class="team-name">${game.home_team}</div>
                <div class="team-name">${game.away_team}</div>
                <div class="venue">${game.venue}</div>
            </div>
        </div>`;
			swiper.appendSlide(slideContent);
		});
	}

	function updateDisplay() {
		const oddsType = document.getElementById('oddsType').value;
		document.querySelectorAll('.matchup-value').forEach((el) => {
			el.style.display = 'none';
		});
		document.querySelectorAll(`[id^='${oddsType}-']`).forEach((el) => {
			el.style.display = 'flex';
		});
	}
</script>
